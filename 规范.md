

## 小程序开发规范

### 常规调用

#### js文件

##### 引入方式

```
//新接入js文件在utilMap中配置 value为路径，只接受单例，常量
var utilMap = {
	navi_util: "/utils/navi_util.js",
	util: '/utils/util.js',//
	emptyView_util: '/utils/emptyView_util',//空界面图片
}
	/**
	 * 引入工具，获取句柄
	 * @param type
	 * @returns {*}
	 */
	getUtil: function (type) {
		if (!utils[type]) {
			utils[type] = require (utilMap[type]);
		}
		return utils[type]
	}
	
//	使用方式
getApp().getUtil('user_util')
```



##### 第三方库说明

###### underscore

[api](http://www.bootcss.com/p/underscore/) 

```
var _ = getApp().getUtil('_');
var data = _.find (list, function (json) {
				return json.type == 1;
			});
```



#### 视图类

##### 确认取消提示框

```
var alertView_util = require ('../../../utils/alertView_util.js');//引入js文件

/**
 * 弹出提示框 目前参数和微信提供的wx.showModal(options)相同
 * @param options
 */
function showModal (options) {
	options.title = options.title || '提示';
	options.message = options.message || '确定要这样做吗？';
	options.confirmColor = options.message || '#f64e4e';
	wx.showModal (options);
}
/**
 *调用示例
 */
alertView_util.showModal ({
					title: '',
					content: '',
					success: function (res) {
						if (res.confirm) {
							//TODO
						} else {
						//TODO CANCEL
						}
					}
				})
```



#### 网络请求

##### 接口调用

```
var network_util = require('../../../utils/network_util.js');//导入请求js文件

network_util._postWithToastView ({
			*url: 接口名,//支持‘接口名’和‘接口名.json’格式
			progressBar:'进度框文字内容',//不传、传空字符显示“加载中”
			*data: {
				...
				memberId: userInfo.memberId,
				enterpriseId: userInfo.enterpriseId,
				...
			},
			*success: function (res) {
				//TODO
				res={
                  data:{
                    response:{
                      errcode:'',
                      errmsg:''
                    }
                  }
				}
			},
			*fail: function (res) {
				//TODO
				res={
                  data:{
                    response:{
                      errcode:'',
                      errmsg:''
                    }
                  }
				}
			}
		})

```

##### 图片上传

```
var network_util = require('../../../utils/network_util.js');//导入请求js文件
/**
 *images 上传图片地址列表
 *uploadSuccList 成功上传的图片列表 对象数据格式 {
 *					image: {
 *						downloadUrl：'',
 *						fileId:''
 *					},
 *					index: _index,
 *				}
 *uploadFailList 上传失败的图片列表 对象格式{
 *			res.data.response.errcode；
 *			res.data.response.errmsg；
 *
 *
 */
network_util.uploadImages (images, function (uploadSuccList,uploadFailList) {
			wx.hideLoading ();
				var contentData = that.data.contentData;
				contentData.imgs = [];
				if (uploadSuccList && uploadSuccList.length == images.length) {
					uploadSuccList.map (function (file) {
						var image = {};
						image.imgUrl = file.image.downloadUrl;
						image.fieldCode = file.image.fileId;
						contentData.imgs.push (image);
					});
					that.setData ({
						contentData: contentData,
						// images: images
					})
					callback (contentData);
				} else {
					callback ();
				}
			}
		);
```

##### 下拉刷新分页加载

```
var that = this;
//调用示例
pullRefresh_util = getApp ().getUtil ('pullRefresh_util');
network_util = getApp ().getUtil ('network_util');
pullRefresh_util.setDataListFunction (function () {
	network_util._postWithToastView ({
		url: '',
		data: {
			...
			currentPage: pullRefresh_util.getCurrentPage ()
		},
		success: function (res) {

		var list = res.response.couponCardList.result;
		pullRefresh_util.setCurrentPage(currentPage + 1);
		pullRefresh_util.setTotalAmount(totalCount);
				
		list.map (function (json) {
			//TODO
			pullRefresh_util.getDataList ().push (json);
		});
					
		that.setData ({
			list: pullRefresh_util.getDataList (),
			})
		},
		fail: function (res) {
			getApp ().getUtil ('toastView_util').showFailToast (res);

			}
		})
	});
```



#### 输入框内容校验

##### 合法性校验 

1. 长度限制	(min,max)；
2. 内容过滤(emoji);
3. 格式校验(phone,email,birthday等等);
4. 数字、金额合法性；

以上内容之后二公子会统一封装提供使用；

#### 图片展现

> 1. 图片host需要从全局变量中获取，不能直接在标签中输入域名；
> 2. 默认展现的内容，如空页面图片，统一封装便于管理维护。

##### 空数据图片

```
var $emptyView = require('../../../utils/emptyView_util.js'); //引入js文件
//emptyView.js里配置图片
var emptyViewMap = {
  nullCoupon: "coupon-null-icon.png",//卡券
  nullData: "data-null-icon.png",//意见反馈
}
//XXX.js data对象里加入图片地址和界面高度
 data: {
	...
    windowHeight: getApp().getUtil('emptyView_util').windowHeight - 50,
    emptyImgUrl: getApp().getUtil('emptyView_util').getEmptyView("nullData"),
    ...
  },
//XXX.wxml 空数据展现标签
 <view  wx:else class='content-null' style="height:{{windowHeight}}px;">
    <view class='content-null-box'>
      <image src="{{emptyImgUrl}}"></image>
      <view class='no-record'>暂无记录</view>
    </view>
  </view>
  
  
```

​

##### 界面icon

```
//XXX.js 申明iconHost 添加到data
var baseUrl = app.globalData.host;
var iconHost = baseUrl +'/images/'
data: {
    ...,
    iconHost: iconHost,
    ...
  },
//XXX.wxml 赋值
  <navigator class="weui-cell weui-cell_access" url="" 
        bindtap='itemClick' data-item_type='{{itemTypeMap.guide}}'
        hover-class="weui-cell_active">
          <view class="weui-cell__hd">
            <image src="{{iconHost}}mc-list-icon-07.png" style="margin-right: 10px;vertical-align: middle;width:20px; height: 20px;"></image>
          </view>
          <view class="weui-cell__bd">我的专属导购</view>
          <view></view>
        </navigator>
```



### 代码规范

#### 方法封装规范

> 意图：统一管理、方便维护、减少重复代码；

1. utils文件夹下的js文件命名规范为"驼峰命名_util.js"，如:alertView_util；
2. 方法命名规范；
3. 备注说明（功能、参数、数据格式、返回值）；
4. 较复杂的api提供使用示例；

### 功能自测

> 意图：所负责的模块除去数据准确性之外，功能尽量没有bug；

测试时“**符合操作规范**”的操作返回成功不能认为自测通过；

#### 自测流程

1. 正常操作，如：按照规范进行内容输入，提交；
2. 非法操作，如：输入非法字符、不输入、非常规长度内容，选择框（地区控件）填选取部分内容，提交；
3. 服务器返回异常的处理；

