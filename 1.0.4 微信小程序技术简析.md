# 微信小程序技术简析

- 基础架构

```
小程序：
  |--------------|    |------------------|
  |  webview     |    |  javascriptcore  |
  |   wxml wxss  |    |    javascript    |
         |                    |
   event |date                | event date
         |                    |
  | -------------------------------------|
  |          weixin jsBridge             |
  |                                      |
  |--------------------------------------|
     |      |      |       |
    网络   存储  多媒体   硬件
     |      |      |       |
     |      |      |       |
微信：
```


- 响应式视图

```

微信开发工具     wxml   ------->   virtual dom   最后 到 WAwebview.js
 上传时候编译                            |
                                              |
                                                      |

                                                              |
小程序
运行时视图根据   .setData  ---> _wxAPPData  -----数据变更--->  WAwebview.js  ---修改变化的 dom 节点---> view
数据响应变更
```


## 工作原理
小程序的视图层目前使用 WebView 作为渲染载体，而逻辑层是由独立的 JavascriptCore 作为运行环境。  
在架构上，WebView 和 JavascriptCore 都是独立的模块，并不具备数据直接共享的通道。  
当前，视图层和逻辑层的数据传输，实际上通过两边提供的 evaluateJavascript 所实现。  
即用户传输的数据，需要将其转换为字符串形式传递，  
同时把转换后的数据内容拼接成一份 JS 脚本，再通过执行 JS 脚本的形式传递到两边独立环境。

而 evaluateJavascript 的执行会受很多方面的影响，数据到达视图层并不是实时的。



## 参考
- https://cloud.tencent.com/developer/edu/learn-1223/3499
- [工作原理](https://developers.weixin.qq.com/miniprogram/dev/framework/performance/tips.html)
