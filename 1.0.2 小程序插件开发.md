# 小程序插件开发

## 创建插件项目
>小程序的 AppID 可以创建小程序插件项目，插件是独立于小程序之外的，但是 AppID 是公用的，所以不要使用原有的小程序项目进行插件开发。
 在创建项目页面，选择一个空文件夹作为项目路径，可以选择创建小程序插件快速启动模板

- 目录结构
```
pluginDemo
├── project.config.json
├── doc
|   └── README.md
│   
│     
├── miniprogram
|   ├── app.js
│   ├── pages
│   |   └──index
|   |      ├── index.js
|   |      ├── index.wxss
|   |      ├── index.json
|   |      └──index.wxml
├── plugin
    ├── index.js
    ├── plugin.json
    |── api
    |    └── data.js
    |
    └── components
        └── list
            ├── list.js
            ├── list.wxss
            ├── list.json
            └── list.wxml
            
    
plugin 目录：插件代码目录。components 中写插件组件
miniprogram 目录：放置一个小程序，用于调试插件。
doc 目录：用于放置插件开发文档。
```

- 在文件 project.config.json 中，我们看到代码如下：
```
{
    "miniprogramRoot": "./miniprogram",
    "pluginRoot": "./plugin",
    "compileType": "plugin",
    "setting": {
        "newFeature": true
    },
    "appid": ".....",
    "projectname": "videoPlayer",
    "condition": {}
}
miniprogramRoot：配置小程序的根目录，可以使用小程序来测试编写的插件

pluginRoot：插件相关代码所在的根目录

compileType：项目的编译类型，必须配置为 plugin，在上传代码的时候才会以插件的方式上传到腾讯服务器。
```
 

- 在 plugin/plugin.json 文件中，代码如下：
```
{
  "publicComponents": {
    "hgPlayer": "components/player/player"
  },
  "main": "index.js"
}
publicComponents：配置的是插件可以给使用的小程序提供哪些组件，一个插件可以定义很多个组件，组件和组件之间相互引用，但是小程序只能使用在publicComponents里配置的组件。
```

>main：定义入口文件，在入口文件 index.js 中定义小程序可以使用插件的那些接口。

 

在 plugin/index.js 文件中，代码如下：

```
var data = require('./api/data.js')

module.exports = {
  getData: data.getData,
  setData: data.setData
}
```

- 在 plugin/index.js 定义了对外抛出接口为 getData 和 setData，小程序在使用这个插件的时候，只能使用到插件提供的这两个接口，插件的其他接口（或方法）小程序无法使用。

做好以上配置后，就可以开始在 plugin/components 编写组件代码

## 使用第三方插件的时候，需要在 我们自己的小程序的 app.json 做如下配置：
```
{
  "pages": [
    "pages/index/index"
  ],
  "plugins": {
    "myPlugin": {
      "version": "dev",
      "provider": "填写申请通过的插件AppId"
    }，
    "plugin1": {
      "version": "dev",
      "provider": "填写申请通过的插件AppId"
    },
     "plugin2": {
      "version": "dev",
      "provider": "填写申请通过的插件AppId"
    }
    ...
  }
}
plugins： 配置的要使用的第三方插件列表。
```


## 参考
- https://developers.weixin.qq.com/miniprogram/dev/framework/plugin/development.html
- https://blog.csdn.net/rolan1993/article/details/79973634
